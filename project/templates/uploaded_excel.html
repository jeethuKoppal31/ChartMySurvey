{% load static %}
<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Favicon icon -->
    {% comment %} <link rel="icon" type="image/png" sizes="16x16" href="{% static 'assets/images/favicon.png' %}"> {% endcomment %}
    <title>ChartMySurvey</title>
    <!-- Custom CSS -->
    <link href="{% static 'assets/libs/chartist/dist/chartist.min.css' %}" rel="stylesheet">
    <link href="{% static 'assets/extra-libs/c3/c3.min.css' %}" rel="stylesheet">
    <link href="{% static 'assets/extra-libs/jvector/jquery-jvectormap-2.0.2.css' %}" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="{% static 'dist/css/style.min.css' %}" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <style>
    .sidebar-nav .nav-link {
        color: #fff !important;   /* white text */
    }

    .sidebar-nav .nav-link:hover {
        color: #4CAF50 !important; /* green on hover */
    }
  </style>
</head>

<body>
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper">
        <!-- ============================================================== -->
        <!-- Topbar header - style you can find in pages.scss -->
        <!-- ============================================================== -->
         <header class="topbar">
  <nav class="navbar navbar-expand-md navbar-dark shadow" style="background: linear-gradient(90deg, #2C3E50, #4CAF50);">
    
    <!-- Brand / Logo -->
    <a class="navbar-brand d-flex align-items-center" href="{% url 'index' %}">
      <h2 class="m-0" style="color: white; font-family: 'Poppins', sans-serif; font-size: 32px; font-weight: 700; letter-spacing: 2px;">
        <span style="color:#FFF;">ChartMySurvey</span>
      </h2>
    </a>

    <!-- Navbar toggler for mobile -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Right side menu -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">

        <!-- Upload Another File -->
        <li class="nav-item">
          <a class="nav-link text-white" href="{% url 'index' %}">
            <i class="mdi mdi-upload"></i> <span style="color:#2C3E50; font-family: 'Poppins', sans-serif">Upload Another File</span>
          </a>
        </li>

        <!-- Logout dropdown -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-white font-weight-bold" href="#" id="navbarDropdown"
             data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             <i class="fa fa-user-circle"></i> <span style="color:#2C3E50;">{{ request.user.username }}</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right shadow animated fadeIn" aria-labelledby="navbarDropdown">
            <div class="dropdown-divider"></div>
            <a class="dropdown-item text-danger font-weight-bold" href="{% url 'logout' %}"
               onclick="return confirm('Are you sure you want to log out?');">
               <i class="fa fa-power-off"></i> Logout
            </a>
          </div>
        </li>

      </ul>
    </div>
  </nav>
</header>

         {% comment %} <header class="topbar">
           
  <nav class="navbar top-navbar navbar-expand-md navbar-dark bg-dark shadow">
   <h2 style="color: #4CAF50; font-family: 'Arial Black', sans-serif; font-size: 36px; text-align: center;">
    ChartMySurvey
</h2>
    <ul class="navbar-nav ml-auto"> <!-- pushes nav items to right -->
        
       <li class="nav-item">
        <a class="nav-link text-white" href="{% url 'index' %}">
          <i class="mdi mdi-directions"></i>
          <span class="hide-menu">Upload another file</span>
        </a>
      </li> 
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle text-white" href="#" id="navbarDropdown"
           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
           Logout {{ request.user.username }}
        </a>
        <div class="dropdown-menu dropdown-menu-right shadow animated fadeIn"
             aria-labelledby="navbarDropdown">
          <div class="dropdown-divider"></div>
          <a class="dropdown-item text-danger font-weight-bold" href="{% url 'logout' %}"
             onclick="return confirm('Are you sure you want to log out?');">
             <i class="fa fa-power-off"></i> Logout
          </a>
        </div>
      </li>
       
    </ul>
  </nav>
</header> {% endcomment %}
        <!-- ============================================================== -->
        <!-- End Topbar header -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Left Sidebar - style you can find in sidebar.scss  -->
        <!-- ============================================================== -->
        <aside class="left-sidebar">
            <!-- Sidebar scroll-->
            <div class="scroll-sidebar">
                
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav">
                    
                    <ul id="sidebarnav">
                      <li class="nav-item">
  <a class="nav-link collapsed" data-bs-target="#survey-questions" data-bs-toggle="collapse" href="#">
    <i class="bi bi-grid"></i><span style="color:#FFF;">SURVEY QUESTIONS</span><i class="bi bi-chevron-down ms-auto"></i>
  </a><ul class ="nav flex-column" id="question-list"></ul>

  
      <!-- JS will insert Question links here -->
  </ul>
</li>


                       
                        
                        <li class="sidebar-item">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="{% url 'logout' %}" aria-expanded="false">
                                <i class="mdi mdi-directions"></i>
                                <span class="hide-menu" style="color:#FFF;">Log Out</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </aside>
        
        <div class="page-wrapper">
            <!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <div class="page-breadcrumb">
                <div class="row">
                    <div class="col-14 align-self-center">
                        <div id="dashboard-question" style="font-size:18px; font-weight:bold; margin:20px;">
    Select a Question
</div>

<ul id="question-list"></ul>

                    </div>
                    <div class="col-7 align-self-center">
                        <div class="d-flex align-items-center justify-content-end">
                            <nav aria-label="breadcrumb">
                               
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Sales chart -->
                <!-- ============================================================== -->
                <div class="card-group">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="d-flex no-block align-items-center">                                
                                          <h2>{{ message }}</h2>




 <div class="page-wrapper">
    <div class="container-fluid">
       
        <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body analytics-info">
                                <h4 class="card-title">Bar Chart</h4>
                                <canvas id="chartCanvas"  class="text-center" ></canvas>

                                   </div>
                        </div>
                    </div>
        <canvas id="chartCanvas" width="900" height="500"></canvas>
    </div>
</div> 


                                       
                                        
                                    </div>
                                </div>
                                <div class="col-12">
                                   
                                </div>
                            </div>
                        </div>
                    </div>
                    
                <!-- ============================================================== -->
                <!-- Recent comment and chats -->
                <!-- ============================================================== -->
            </div>
            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- footer -->
            <!-- ============================================================== -->
            
            <!-- ============================================================== -->
            <!-- End footer -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Page wrapper  -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Wrapper -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- customizer Panel -->
    <!-- ============================================================== -->
    
    <div class="chat-windows"></div>
    <!-- ============================================================== -->
    <!-- All Jquery -->
    <!-- ============================================================== -->
     <script>
    fetch(`/media/results/{{ json_file }}`)
        .then(response => response.json())
        .then(summary => {
            // build sidebar + charts here
        });
</script>
    <script src="{% static 'assets/libs/jquery/dist/jquery.min.js' %}"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="{% static 'assets/libs/popper.js/dist/umd/popper.min.js' %}"></script>
    <script src="{% static 'assets/libs/bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <!-- apps -->
    <script src="{% static 'dist/js/app.min.js' %}"></script>
    <script src="{% static 'dist/js/app.init.js' %}"></script>
    <script src="{% static 'dist/js/app-style-switcher.js' %}"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <script src="{% static 'assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js' %}"></script>
    <script src="{% static 'assets/extra-libs/sparkline/sparkline.js' %}"></script>
    <!--Wave Effects -->
    <script src="{% static 'dist/js/waves.js' %}"></script>
    <!--Menu sidebar -->
    <script src="{% static 'dist/js/sidebarmenu.js' %}"></script>
    <!--Custom JavaScript -->
    <script src="{% static 'dist/js/custom.min.js' %}"></script>
    <!--This page JavaScript -->
    <!--chartis chart-->
    <script src="{% static 'assets/libs/chartist/dist/chartist.min.js' %}"></script>
    <script src="{% static 'assets/libs/chartist-plugin-tooltips/dist/chartist-plugin-tooltip.min.js' %}"></script>
    <!--c3 charts -->
    <script src="{% static 'assets/extra-libs/c3/d3.min.js' %}"></script>
    <script src="{% static 'assets/extra-libs/c3/c3.min.js' %}"></script>
    <script src="{% static 'assets/extra-libs/jvector/jquery-jvectormap-2.0.2.min.js' %}"></script>
    <script src="{% static 'assets/extra-libs/jvector/jquery-jvectormap-world-mill-en.js' %}"></script>
    <script src="{% static 'dist/js/pages/dashboards/dashboard1.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    


  

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sparklines/2.1.2/jquery.sparkline.min.js"></script>

 <script>
    // Django JSON
    const summary = {{ summary_json|safe }};
    console.log("Survey Summary:", summary);

    const questionList = document.getElementById("question-list");
    let qNum = 1;

    for (const question in summary) {
        const li = document.createElement("li");
        li.classList.add("nav-item");
        li.innerHTML = `<a href="#" class="nav-link" data-q="${question}">Question ${qNum}</a>`;
        questionList.appendChild(li);
        qNum++;
    }

    // Chart.js setup
    const ctx = document.getElementById("chartCanvas").getContext("2d");
    let chart;

    // Function to render chart
    function renderChart(questionText) {
        const labels = Object.keys(summary[questionText]);   // Answer options
        const values = Object.values(summary[questionText]); // Counts
        console.log("Rendering chart for:", questionText, labels, values);

        document.getElementById("dashboard-question").innerText = questionText;
        document.querySelector(".card-title").innerText = "Responses";

        if (chart) {
            chart.destroy();
        }

        chart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: labels,
                datasets: [{
                    label: "Responses",
                    data: values,
                    backgroundColor: "#99d683"
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        grid: { display: false }, // hide vertical grid lines
                        ticks: { display: true }  // keep labels (Yes/No/etc.)
                    },
                    y: {
                        grid: { display: false }, // hide horizontal grid lines
                        ticks: { display: false } // hide numbers
                    }
                }
            }
        });
    }

    // Sidebar click
    document.querySelectorAll("#question-list a").forEach(a => {
        a.addEventListener("click", function(e) {
            e.preventDefault();
            const q = this.getAttribute("data-q");
            renderChart(q);
        });
    });

    // First question load
    const firstQ = Object.keys(summary)[0];
    if (firstQ) renderChart(firstQ);
</script>



{% comment %} <script>
    // Django JSON
    const summary = {{ summary_json|safe }};
    console.log("Survey Summary:", summary);

    // Sidebar list
    const questionList = document.getElementById("question-list");
    let qNum = 1;

    for (const question in summary) {
        const li = document.createElement("li");
        li.classList.add("nav-item");
        li.innerHTML = `<a href="#" class="nav-link" data-q="${question}">Question ${qNum}</a>`;
        questionList.appendChild(li);
        qNum++;
    }

    // Chart.js setup
    const ctx = document.getElementById("chartCanvas").getContext("2d");
    let chart;

    // Function to render chart + set question text
    function renderChart(questionText) {
        const labels = Object.keys(summary[questionText]);   // Answer options
        const values = Object.values(summary[questionText]); // Counts
        console.log("Rendering chart for:", questionText, labels, values);

        // 👉 Update top question text
        document.getElementById("dashboard-question").innerText = questionText;

        // 👉 Keep chart card title generic
        document.querySelector(".card-title").innerText = "Responses";

        // Destroy old chart before creating new one
        if (chart) {
            chart.destroy();
        }

        // 👉 Draw Chart.js bar chart
        chart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: labels,
                datasets: [{
                    label: "Responses",
                    data: values,
                    backgroundColor: "#99d683"
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }, // hide "Responses" legend if you want
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { precision: 0 }
                    }
                }
            }
        });
    }

    // Sidebar click event
    document.querySelectorAll("#question-list a").forEach(a => {
        a.addEventListener("click", function(e) {
            e.preventDefault();
            const q = this.getAttribute("data-q");
            renderChart(q);
        });
    });

    // Load first question automatically
    const firstQ = Object.keys(summary)[0];
    if (firstQ) renderChart(firstQ);
</script> {% endcomment %}






</body>

</html>